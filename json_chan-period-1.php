<?php
// appelé par ajax, reçoit 1 channel en parametre et renvoi un objet serie
// pour page_1_24h.php
require_once("conf/config.inc.php");
require_once("conf/BDD_description_chanel.php");
require_once("conf/firmware.inc.php");
 
	header("Content-type: text/json");

    $id = $_GET["id"];
    $periode = $_GET["periode"];
	
	// switch ($firmware) { // dictionnaire faisant le lien entre le T et le c
		// case '14k':
			// $dict = ['c0','c1','c2','c3','c4','c5','c53','c52','c134','c56',
			// 'c57','c58','c59','c60','c61','c6','c7','c8','c178','c9',
			// 'c179','c10','c11','c12','c13','c15','c129','c160','c54','c55',
			// 'c116','c117','c112','c111','c113','c114','c154','c130','c136','c62',
			// 'c95','c96','c180','c177','c176','c128','c115','c99','c81','c97',
			// 'c16','c17','c137','c45','c84','c100','c21','c23','c138','c46','c85',
			// 'c101','c22','c24','c139','c47','c86','c102','c29','c31','c140',
			// 'c48','c87','c103','c30','c32','c141','c49','c88','c104','c37',
			// 'c39','c142','c50','c89','c105','c38','c40','c143','c51','c90',
			// 'c106','c19','c20','c91','c27','c28','c92','c35','c36','c93',
			// 'c43','c44','c94','c107','c108','c109','c110','c168','c146','c147',
			// 'c148','c149','c150','c151','c152','c153','c169','c170','c171','c172',
			// 'c173','c174','c175','c73','c74','c75','c76','c77','c78','c79',
			// 'c80','c118','c119','c120']; //,'','','','','','',
			// '','','','','','','','','','',
			// '','','','','','','','','','',
			// '','','','','','','','','','',
			// '','','','','','','','','','',
			// '','c182','c183','','','','c187'];
		// $dict = [
			 // 0 =>'c0'  ,  1=>'c1'  ,  2=>'c2'  ,  3=>'c3'  ,  4=>'c4'  ,  5=>'c5'  ,  6=>'c53' ,  7=>'c52' ,  8=>'c134',  9=>'c56',
			// 10 =>'c57' , 11=>'c58' , 12=>'c59' , 13=>'c60' , 14=>'c61' , 15=>'c6'  , 16=>'c7'  , 17=>'c8'  , 18=>'c178', 19=>'c9',
			// 20 =>'c179', 21=>'c10' , 22=>'c11' , 23=>'c12' , 24=>'c13' , 25=>'c15' , 26=>'c129', 27=>'c160', 28=>'c54' , 29=>'c55',
			// 30 =>'c116', 31=>'c117', 32=>'c112', 33=>'c111', 34=>'c113', 35=>'c114', 36=>'c154', 37=>'c130', 38=>'c136', 39=>'c62',
			// 40 =>'c95' , 41=>'c96' , 42=>'c180', 43=>'c177', 44=>'c176', 45=>'c128', 46=>'c115', 47=>'c99' , 48=>'c81' , 49=>'c97',
			// 50 =>'c16' , 51=>'c17' , 52=>'c137', 53=>'c45' , 54=>'c84' , 55=>'c100', 56=>'c21' , 57=>'c23' , 58=>'c138', 59=>'c46',
			// 60 =>'c85' , 61=>'c101', 62=>'c22' , 63=>'c24' , 64=>'c139', 65=>'c47' , 66=>'c86' , 67=>'c102', 68=>'c29' , 69=>'c31',
			// 70 =>'c140', 71=>'c48' , 72=>'c87' , 73=>'c103', 74=>'c30' , 75=>'c32' , 76=>'c141', 77=>'c49' , 78=>'c88' , 79=>'c104',
			// 80 =>'c37' , 81=>'c39' , 82=>'c142', 83=>'c50' , 84=>'c89' , 85=>'c105', 86=>'c38' , 87=>'c40' , 88=>'c143', 89=>'c51',
			// 90 =>'c90' , 91=>'c106', 92=>'c19' , 93=>'c20' , 94=>'c91' , 95=>'c27' , 96=>'c28' , 97=>'c92' , 98=>'c35' , 99=>'c36',
			// 100=>'c93' ,101=>'c43' ,102=>'c44' ,103=>'c94' ,104=>'c107',105=>'c108',106=>'c109',107=>'c110',108=>'c168',109=>'c146',
			// 110=>'c147',111=>'c148',112=>'c149',113=>'c150',114=>'c151',115=>'c152',116=>'c153',117=>'c169',118=>'c170',119=>'c171',
			// 120=>'c172',121=>'c173',122=>'c174',123=>'c175',124=>'c73' ,125=>'c74' ,126=>'c75' ,127=>'c76' ,128=>'c77' ,129=>'c78',
			// 130=>'c79' ,131=>'c80' ,132=>'c118',133=>'c119',134=>'c120',			182=>'c182',183=>'c183',187=>'c187'
		// ]; 
			// break;
	// }

// utilisation du dictionnaire de firmware.inc.php
// pour determiner les colonne valide
	$channel = $dict[$id];

	if ($channel) {
		$query = "SELECT dateB,$channel FROM data
				  ORDER by dateB DESC LIMIT $periode";
		$conn = mysqli_connect ($hostname, $username, $password, $database); 
		if (!$conn) {
			die("Connection failed: " . mysqli_connect_error());
		}
		$req = mysqli_query($conn, $query);
		mysqli_close($conn);
		
		while($data = mysqli_fetch_row($req)){
			$dateD = strtotime($data[0]) * 1000;
			$liste[] = [$dateD, $data[1]];
		}
		$liste = array_reverse($liste);
    }          


    $obj = ['name'=> 't'.$id.'/'.$channel.'/'.$BDD[$channel]['desc'] ,
			'data'=> $liste,
			'id'  => 't'.$id,
			];

    echo json_encode($obj, JSON_NUMERIC_CHECK);
	
?>
